import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';

class ThemeController extends ValueNotifier<ThemeData> {
  ThemeController({ThemeData theme})
      : super(theme == null ? stickyLight : theme);

  static final stickyLight = StickyThemeData(
    brightness: Brightness.light,
    primarySwatch: Colors.blue,
    backgroundColor: Colors.white,
    scaffoldBackgroundColor: Colors.white,
    appBarTheme: AppBarTheme(
      brightness: Brightness.light,
      color: Colors.white,
      iconTheme: ThemeData.light().iconTheme,
    ),
    textTheme: ThemeData.light()
        .textTheme
        .apply(bodyColor: Colors.black, displayColor: Colors.black),
  );

  ThemeData get theme => value;

  StickyThemeData get stickyTheme => value as StickyThemeData;

  // TODO(microtears) debug help method, please remove before release.
  void refresh() {
    value = StickyThemeData(
      brightness: Brightness.light,
      primarySwatch: Colors.blue,
      backgroundColor: Colors.white,
      scaffoldBackgroundColor: Colors.white,
      appBarTheme: AppBarTheme(
        brightness: Brightness.light,
        color: Colors.white,
        iconTheme: ThemeData.light().iconTheme,
      ),
      textTheme: ThemeData.light()
          .textTheme
          .apply(bodyColor: Colors.black, displayColor: Colors.black),
    );
    notifyListeners();
  }

  static ThemeController of(BuildContext context) {
    return Provider.of<ThemeController>(context, listen: false);
  }
}

class StickyTheme extends Theme {
  const StickyTheme({
    Key key,
    @required ThemeData data,
    bool isMaterialAppTheme = false,
    @required Widget child,
  }) : super(
          key: key,
          data: data,
          isMaterialAppTheme: isMaterialAppTheme,
          child: child,
        );

  static StickyThemeData of(BuildContext context,
      {bool shadowThemeOnly = false}) {
    return Theme.of(context, shadowThemeOnly: shadowThemeOnly)
        as StickyThemeData;
  }
}

class StickyThemeData extends ThemeData {
  /// It can be Http URI or file URI or `null`.
  final Uri backgroundImage;

  /// Background gradient color list,
  /// default value is pure background color.
  final List<Color> backgroundColors;

  factory StickyThemeData({
    Uri backgroundImage,
    List<Color> backgroundColors,
    Brightness brightness,
    MaterialColor primarySwatch,
    Color primaryColor,
    Brightness primaryColorBrightness,
    Color primaryColorLight,
    Color primaryColorDark,
    Color accentColor,
    Brightness accentColorBrightness,
    Color canvasColor,
    Color scaffoldBackgroundColor,
    Color bottomAppBarColor,
    Color cardColor,
    Color dividerColor,
    Color focusColor,
    Color hoverColor,
    Color highlightColor,
    Color splashColor,
    InteractiveInkFeatureFactory splashFactory,
    Color selectedRowColor,
    Color unselectedWidgetColor,
    Color disabledColor,
    Color buttonColor,
    ButtonThemeData buttonTheme,
    Color secondaryHeaderColor,
    Color textSelectionColor,
    Color cursorColor,
    Color textSelectionHandleColor,
    Color backgroundColor,
    Color dialogBackgroundColor,
    Color indicatorColor,
    Color hintColor,
    Color errorColor,
    Color toggleableActiveColor,
    String fontFamily,
    TextTheme textTheme,
    TextTheme primaryTextTheme,
    TextTheme accentTextTheme,
    InputDecorationTheme inputDecorationTheme,
    IconThemeData iconTheme,
    IconThemeData primaryIconTheme,
    IconThemeData accentIconTheme,
    SliderThemeData sliderTheme,
    TabBarTheme tabBarTheme,
    CardTheme cardTheme,
    ChipThemeData chipTheme,
    TargetPlatform platform,
    MaterialTapTargetSize materialTapTargetSize,
    PageTransitionsTheme pageTransitionsTheme,
    AppBarTheme appBarTheme,
    BottomAppBarTheme bottomAppBarTheme,
    ColorScheme colorScheme,
    DialogTheme dialogTheme,
    FloatingActionButtonThemeData floatingActionButtonTheme,
    Typography typography,
    CupertinoThemeData cupertinoOverrideTheme,
    SnackBarThemeData snackBarTheme,
    BottomSheetThemeData bottomSheetTheme,
  }) {
    final rawThemeData = ThemeData(
      brightness: brightness,
      primaryColor: primaryColor,
      primaryColorBrightness: primaryColorBrightness,
      primaryColorLight: primaryColorLight,
      primaryColorDark: primaryColorDark,
      accentColor: accentColor,
      accentColorBrightness: accentColorBrightness,
      canvasColor: canvasColor,
      scaffoldBackgroundColor: scaffoldBackgroundColor,
      bottomAppBarColor: bottomAppBarColor,
      cardColor: cardColor,
      dividerColor: dividerColor,
      focusColor: focusColor,
      hoverColor: hoverColor,
      highlightColor: highlightColor,
      splashColor: splashColor,
      splashFactory: splashFactory,
      selectedRowColor: selectedRowColor,
      unselectedWidgetColor: unselectedWidgetColor,
      disabledColor: disabledColor,
      buttonTheme: buttonTheme,
      buttonColor: buttonColor,
      toggleableActiveColor: toggleableActiveColor,
      secondaryHeaderColor: secondaryHeaderColor,
      textSelectionColor: textSelectionColor,
      cursorColor: cursorColor,
      textSelectionHandleColor: textSelectionHandleColor,
      backgroundColor: backgroundColor,
      dialogBackgroundColor: dialogBackgroundColor,
      indicatorColor: indicatorColor,
      hintColor: hintColor,
      errorColor: errorColor,
      textTheme: textTheme,
      primaryTextTheme: primaryTextTheme,
      accentTextTheme: accentTextTheme,
      inputDecorationTheme: inputDecorationTheme,
      iconTheme: iconTheme,
      primaryIconTheme: primaryIconTheme,
      accentIconTheme: accentIconTheme,
      sliderTheme: sliderTheme,
      tabBarTheme: tabBarTheme,
      cardTheme: cardTheme,
      chipTheme: chipTheme,
      platform: platform,
      materialTapTargetSize: materialTapTargetSize,
      pageTransitionsTheme: pageTransitionsTheme,
      appBarTheme: appBarTheme,
      bottomAppBarTheme: bottomAppBarTheme,
      colorScheme: colorScheme,
      dialogTheme: dialogTheme,
      floatingActionButtonTheme: floatingActionButtonTheme,
      typography: typography,
      cupertinoOverrideTheme: cupertinoOverrideTheme,
      snackBarTheme: snackBarTheme,
      bottomSheetTheme: bottomSheetTheme,
    );
    backgroundColors ??= [
      rawThemeData.backgroundColor,
      rawThemeData.backgroundColor,
    ];
    return StickyThemeData.raw(
      backgroundColors: backgroundColors,
      backgroundImage: backgroundImage,
      brightness: rawThemeData.brightness,
      primaryColor: rawThemeData.primaryColor,
      primaryColorBrightness: rawThemeData.primaryColorBrightness,
      primaryColorLight: rawThemeData.primaryColorLight,
      primaryColorDark: rawThemeData.primaryColorDark,
      accentColor: rawThemeData.accentColor,
      accentColorBrightness: rawThemeData.accentColorBrightness,
      canvasColor: rawThemeData.canvasColor,
      scaffoldBackgroundColor: rawThemeData.scaffoldBackgroundColor,
      bottomAppBarColor: rawThemeData.bottomAppBarColor,
      cardColor: rawThemeData.cardColor,
      dividerColor: rawThemeData.dividerColor,
      focusColor: rawThemeData.focusColor,
      hoverColor: rawThemeData.hoverColor,
      highlightColor: rawThemeData.highlightColor,
      splashColor: rawThemeData.splashColor,
      splashFactory: rawThemeData.splashFactory,
      selectedRowColor: rawThemeData.selectedRowColor,
      unselectedWidgetColor: rawThemeData.unselectedWidgetColor,
      disabledColor: rawThemeData.disabledColor,
      buttonTheme: rawThemeData.buttonTheme,
      buttonColor: rawThemeData.buttonColor,
      toggleableActiveColor: rawThemeData.toggleableActiveColor,
      secondaryHeaderColor: rawThemeData.secondaryHeaderColor,
      textSelectionColor: rawThemeData.textSelectionColor,
      cursorColor: rawThemeData.cursorColor,
      textSelectionHandleColor: rawThemeData.textSelectionHandleColor,
      backgroundColor: rawThemeData.backgroundColor,
      dialogBackgroundColor: rawThemeData.dialogBackgroundColor,
      indicatorColor: rawThemeData.indicatorColor,
      hintColor: rawThemeData.hintColor,
      errorColor: rawThemeData.errorColor,
      textTheme: rawThemeData.textTheme,
      primaryTextTheme: rawThemeData.primaryTextTheme,
      accentTextTheme: rawThemeData.accentTextTheme,
      inputDecorationTheme: rawThemeData.inputDecorationTheme,
      iconTheme: rawThemeData.iconTheme,
      primaryIconTheme: rawThemeData.primaryIconTheme,
      accentIconTheme: rawThemeData.accentIconTheme,
      sliderTheme: rawThemeData.sliderTheme,
      tabBarTheme: rawThemeData.tabBarTheme,
      cardTheme: rawThemeData.cardTheme,
      chipTheme: rawThemeData.chipTheme,
      platform: rawThemeData.platform,
      materialTapTargetSize: rawThemeData.materialTapTargetSize,
      pageTransitionsTheme: rawThemeData.pageTransitionsTheme,
      appBarTheme: rawThemeData.appBarTheme,
      bottomAppBarTheme: rawThemeData.bottomAppBarTheme,
      colorScheme: rawThemeData.colorScheme,
      dialogTheme: rawThemeData.dialogTheme,
      floatingActionButtonTheme: rawThemeData.floatingActionButtonTheme,
      typography: rawThemeData.typography,
      cupertinoOverrideTheme: rawThemeData.cupertinoOverrideTheme,
      snackBarTheme: rawThemeData.snackBarTheme,
      bottomSheetTheme: rawThemeData.bottomSheetTheme,
    );
  }

  const StickyThemeData.raw({
    @required this.backgroundImage,
    @required this.backgroundColors,
    Brightness brightness,
    MaterialColor primarySwatch,
    Color primaryColor,
    Brightness primaryColorBrightness,
    Color primaryColorLight,
    Color primaryColorDark,
    Color accentColor,
    Brightness accentColorBrightness,
    Color canvasColor,
    Color scaffoldBackgroundColor,
    Color bottomAppBarColor,
    Color cardColor,
    Color dividerColor,
    Color focusColor,
    Color hoverColor,
    Color highlightColor,
    Color splashColor,
    InteractiveInkFeatureFactory splashFactory,
    Color selectedRowColor,
    Color unselectedWidgetColor,
    Color disabledColor,
    Color buttonColor,
    ButtonThemeData buttonTheme,
    Color secondaryHeaderColor,
    Color textSelectionColor,
    Color cursorColor,
    Color textSelectionHandleColor,
    Color backgroundColor,
    Color dialogBackgroundColor,
    Color indicatorColor,
    Color hintColor,
    Color errorColor,
    Color toggleableActiveColor,
    String fontFamily,
    TextTheme textTheme,
    TextTheme primaryTextTheme,
    TextTheme accentTextTheme,
    InputDecorationTheme inputDecorationTheme,
    IconThemeData iconTheme,
    IconThemeData primaryIconTheme,
    IconThemeData accentIconTheme,
    SliderThemeData sliderTheme,
    TabBarTheme tabBarTheme,
    CardTheme cardTheme,
    ChipThemeData chipTheme,
    TargetPlatform platform,
    MaterialTapTargetSize materialTapTargetSize,
    PageTransitionsTheme pageTransitionsTheme,
    AppBarTheme appBarTheme,
    BottomAppBarTheme bottomAppBarTheme,
    ColorScheme colorScheme,
    DialogTheme dialogTheme,
    FloatingActionButtonThemeData floatingActionButtonTheme,
    Typography typography,
    CupertinoThemeData cupertinoOverrideTheme,
    SnackBarThemeData snackBarTheme,
    BottomSheetThemeData bottomSheetTheme,
  }) : super.raw(
          brightness: brightness,
          primaryColor: primaryColor,
          primaryColorBrightness: primaryColorBrightness,
          primaryColorLight: primaryColorLight,
          primaryColorDark: primaryColorDark,
          accentColor: accentColor,
          accentColorBrightness: accentColorBrightness,
          canvasColor: canvasColor,
          scaffoldBackgroundColor: scaffoldBackgroundColor,
          bottomAppBarColor: bottomAppBarColor,
          cardColor: cardColor,
          dividerColor: dividerColor,
          focusColor: focusColor,
          hoverColor: hoverColor,
          highlightColor: highlightColor,
          splashColor: splashColor,
          splashFactory: splashFactory,
          selectedRowColor: selectedRowColor,
          unselectedWidgetColor: unselectedWidgetColor,
          disabledColor: disabledColor,
          buttonTheme: buttonTheme,
          buttonColor: buttonColor,
          toggleableActiveColor: toggleableActiveColor,
          secondaryHeaderColor: secondaryHeaderColor,
          textSelectionColor: textSelectionColor,
          cursorColor: cursorColor,
          textSelectionHandleColor: textSelectionHandleColor,
          backgroundColor: backgroundColor,
          dialogBackgroundColor: dialogBackgroundColor,
          indicatorColor: indicatorColor,
          hintColor: hintColor,
          errorColor: errorColor,
          textTheme: textTheme,
          primaryTextTheme: primaryTextTheme,
          accentTextTheme: accentTextTheme,
          inputDecorationTheme: inputDecorationTheme,
          iconTheme: iconTheme,
          primaryIconTheme: primaryIconTheme,
          accentIconTheme: accentIconTheme,
          sliderTheme: sliderTheme,
          tabBarTheme: tabBarTheme,
          cardTheme: cardTheme,
          chipTheme: chipTheme,
          platform: platform,
          materialTapTargetSize: materialTapTargetSize,
          pageTransitionsTheme: pageTransitionsTheme,
          appBarTheme: appBarTheme,
          bottomAppBarTheme: bottomAppBarTheme,
          colorScheme: colorScheme,
          dialogTheme: dialogTheme,
          floatingActionButtonTheme: floatingActionButtonTheme,
          typography: typography,
          cupertinoOverrideTheme: cupertinoOverrideTheme,
          snackBarTheme: snackBarTheme,
          bottomSheetTheme: bottomSheetTheme,
        );
}
